<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>NotesShare — Simple notes sharing</title>
  <style>
    :root{--bg:#f6f8fb;--card:#fff;--accent:#3b82f6;--muted:#6b7280;--danger:#ef4444}
    *{box-sizing:border-box}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:var(--bg); color:#111}
    .container{max-width:1000px;margin:28px auto;padding:20px}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;background:var(--accent);border-radius:8px;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow: 0 1px 4px rgba(0,0,0,0.06)}
    .form-row{display:flex;gap:8px;margin-bottom:8px}
    input[type="text"], textarea{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-size:14px}
    textarea{min-height:140px;resize:vertical}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn.secondary{background:#fff;color:var(--accent);border:1px solid #e6eefb}
    .note-list{max-height:580px;overflow:auto;padding-top:6px}
    .note-item{border:1px solid #f0f3f8;padding:10px;border-radius:8px;margin-bottom:8px;display:flex;flex-direction:column;gap:8px}
    .note-title{font-weight:600}
    .note-actions{display:flex;gap:8px}
    .small{font-size:13px;color:var(--muted)}
    .search{display:flex;gap:8px;margin-bottom:12px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .preview{white-space:pre-wrap;background:#f8fafc;padding:12px;border-radius:6px;border:1px dashed #e6eefb}
    .footer{margin-top:18px;font-size:13px;color:var(--muted)}
    @media(max-width:880px){ .grid{grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo">NS</div>
        <div>
          <h1>NotesShare</h1>
          <p class="lead">Create, save, export and share notes — publishes as a static site (localStorage).</p>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="exportAllBtn">Export All</button>
        <button class="btn secondary" id="importBtn">Import</button>
        <input type="file" id="importFile" accept=".json" style="display:none">
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="form-row">
          <input type="text" id="noteTitle" placeholder="Title (e.g. Lecture 3)">
        </div>
        <div class="form-row">
          <textarea id="noteContent" placeholder="Write your note here..."></textarea>
        </div>
        <div class="form-row">
          <button class="btn" id="saveBtn">Save Note</button>
          <button class="btn secondary" id="clearBtn">Clear</button>
          <button class="btn secondary" id="downloadAllBtn">Download All</button>
        </div>
        <div style="margin-top:12px">
          <input type="text" id="searchInput" placeholder="Search notes..." style="width:100%;padding:8px;border-radius:8px;border:1px solid #e5e7eb">
        </div>

        <div class="note-list" id="notesContainer" style="margin-top:12px"></div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Your Notes</strong>
          <span class="small" id="countLabel">0 notes</span>
        </div>
        <div class="search">
          <input type="text" id="quickSearch" placeholder="Filter by title..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #e5e7eb">
          <button class="btn secondary" id="newExample">+ Example</button>
        </div>
        <div id="sideList" style="max-height:520px;overflow:auto"></div>

        <div class="footer">
          <p class="small">Share a note: click Share → Copy link → send the link. When opened, the note appears and can be saved into the receiver's notes.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- modal for preview -->
  <div id="modal" style="position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35)">
    <div style="width:90%;max-width:760px;background:#fff;border-radius:12px;padding:16px;box-shadow:0 8px 30px rgba(2,6,23,0.2)">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong id="modalTitle"></strong>
        <div>
          <button id="modalSaveBtn" class="btn">Save to my notes</button>
          <button id="modalClose" class="btn secondary">Close</button>
        </div>
      </div>
      <div id="modalContent" class="preview"></div>
    </div>
  </div>

  <script>
  /* NotesShare — stores notes in localStorage and supports export/import & share via URL hash */
  const STORAGE_KEY = 'notesShareNotesV1';

  function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8) }

  function loadNotes(){
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch (e) { return []; }
  }
  function saveNotes(notes){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
    renderSideList(notes);
    renderNotes(notes, document.getElementById('searchInput').value);
  }
  function addNote(note){
    const notes = loadNotes();
    notes.unshift(note);
    saveNotes(notes);
  }
  function updateNoteById(id, data){
    const notes = loadNotes().map(n => n.id === id ? {...n, ...data, updatedAt: new Date().toISOString()} : n);
    saveNotes(notes);
  }
  function deleteNoteById(id){
    const notes = loadNotes().filter(n => n.id !== id);
    saveNotes(notes);
  }

  function renderNotes(notes, filter=''){
    const container = document.getElementById('notesContainer');
    container.innerHTML = '';
    const f = filter.trim().toLowerCase();
    const filtered = notes.filter(n => n.title.toLowerCase().includes(f) || n.content.toLowerCase().includes(f));
    document.getElementById('countLabel').textContent = filtered.length + ' notes';
    if(filtered.length === 0){
      container.innerHTML = '<div class="small">No notes yet — create one above.</div>';
      return;
    }
    filtered.forEach(note => {
      const el = document.createElement('div');
      el.className = 'note-item';
      el.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="note-title">${escapeHtml(note.title || 'Untitled')}</div>
            <div class="small">${new Date(note.updatedAt || note.createdAt).toLocaleString()}</div>
          </div>
        </div>
        <div class="small">${escapeHtml(note.content.substring(0,200))}${note.content.length>200?'…':''}</div>
        <div class="note-actions">
          <button class="btn" data-action="view" data-id="${note.id}">View</button>
          <button class="btn secondary" data-action="edit" data-id="${note.id}">Edit</button>
          <button class="btn secondary" data-action="download" data-id="${note.id}">Download</button>
          <button class="btn secondary" data-action="share" data-id="${note.id}">Share</button>
          <button class="btn" style="background:var(--danger)" data-action="delete" data-id="${note.id}">Delete</button>
        </div>
      `;
      container.appendChild(el);
    });
  }

  function renderSideList(notes){
    const side = document.getElementById('sideList');
    side.innerHTML = '';
    notes.forEach(n=>{
      const d = document.createElement('div');
      d.style.padding='8px'; d.style.borderBottom='1px solid #f3f4f6';
      d.innerHTML = `<div style="font-weight:600">${escapeHtml(n.title||'Untitled')}</div><div class="small">${new Date(n.updatedAt||n.createdAt).toLocaleString()}</div>`;
      d.addEventListener('click', ()=>{ showModal(n, false); });
      side.appendChild(d);
    });
  }

  function escapeHtml(str){
    return String(str||'').replace(/[&<>\"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]});
  }

  /* Save form */
  document.getElementById('saveBtn').addEventListener('click', ()=>{
    const title = document.getElementById('noteTitle').value.trim();
    const content = document.getElementById('noteContent').value.trim();
    if(!content && !title){ alert('Add a title or note content.'); return; }
    const note = { id: uid(), title, content, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() };
    addNote(note);
    document.getElementById('noteTitle').value=''; document.getElementById('noteContent').value='';
  });

  /* Clear */
  document.getElementById('clearBtn').addEventListener('click', ()=>{
    document.getElementById('noteTitle').value=''; document.getElementById('noteContent').value='';
  });

  /* Example note */
  document.getElementById('newExample').addEventListener('click', ()=>{
    const note = { id: uid(), title: 'Example — Lecture: Binary Trees', content: 'Key points:\n1) Node, left/right child\n2) Traversals: in/pre/post\n3) Applications: BST, heap', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() };
    addNote(note);
  });

  /* Search */
  document.getElementById('searchInput').addEventListener('input', (e)=>{
    renderNotes(loadNotes(), e.target.value);
  });
  document.getElementById('quickSearch').addEventListener('input', (e)=>{
    const q=e.target.value.trim().toLowerCase();
    const notes = loadNotes().filter(n => n.title.toLowerCase().includes(q) || n.content.toLowerCase().includes(q));
    renderSideList(notes);
  });

  /* note actions (view/edit/delete/download/share) */
  document.getElementById('notesContainer').addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const action = btn.dataset.action;
    const id = btn.dataset.id;
    const notes = loadNotes();
    const note = notes.find(n => n.id === id);
    if(action === 'view'){ showModal(note, false); }
    if(action === 'edit'){
      document.getElementById('noteTitle').value = note.title;
      document.getElementById('noteContent').value = note.content;
      deleteNoteById(id);
    }
    if(action === 'delete'){ if(confirm('Delete this note?')) deleteNoteById(id); }
    if(action === 'download'){ downloadText(note.title || 'note', note.content); }
    if(action === 'share'){ const url = generateShareLink(note); copyToClipboard(url); alert('Link copied to clipboard:\n' + url); }
  });

  /* download single or all */
  function downloadText(name, text){
    const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = (name.replace(/[\\/:*?"<>|]/g,'_') || 'note') + '.txt';
    document.body.appendChild(a); a.click(); a.remove();
  }
  document.getElementById('downloadAllBtn').addEventListener('click', ()=>{
    const notes = loadNotes();
    const json = JSON.stringify(notes, null, 2);
    const blob = new Blob([json], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'notes-export.json'; document.body.appendChild(a); a.click(); a.remove();
  });
  document.getElementById('exportAllBtn').addEventListener('click', ()=>{ document.getElementById('downloadAllBtn').click(); });

  /* import */
  document.getElementById('importBtn').addEventListener('click', ()=>{ document.getElementById('importFile').click(); });
  document.getElementById('importFile').addEventListener('change', (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const reader = new FileReader();
    reader.onload = ()=> {
      try {
        const parsed = JSON.parse(reader.result);
        if(!Array.isArray(parsed)) throw new Error('Invalid format');
        const existing = loadNotes();
        saveNotes(parsed.concat(existing)); // prepend imported
        alert('Imported ' + parsed.length + ' notes.');
      } catch (err) { alert('Import failed: ' + err.message); }
    };
    reader.readAsText(f);
  });

  /* modal */
  function showModal(note, allowSave=true){
    if(!note) return;
    document.getElementById('modalTitle').textContent = note.title || 'Untitled';
    document.getElementById('modalContent').textContent = note.content || '';
    document.getElementById('modalSaveBtn').onclick = ()=>{ addNote(note); alert('Saved to your notes.'); };
    document.getElementById('modalClose').onclick = ()=>{ document.getElementById('modal').style.display='none'; };
    document.getElementById('modal').style.display = 'flex';
  }

  /* share link - encode note into hash */
  function base64EncodeUnicode(str){
    return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function(match, p1){ return String.fromCharCode('0x' + p1); }));
  }
  function base64DecodeUnicode(str){
    return decodeURIComponent(Array.prototype.map.call(atob(str), function(c){ return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2); }).join(''));
  }

  function generateShareLink(note){
    const payload = JSON.stringify({title:note.title, content:note.content});
    const encoded = base64EncodeUnicode(payload);
    const url = window.location.origin + window.location.pathname + '#note=' + encoded;
    return url;
  }
  async function copyToClipboard(text){
    try { await navigator.clipboard.writeText(text); } catch(e){ const ta = document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }
  }

  /* On load: render existing notes and check hash */
  (function init(){
    const notes = loadNotes();
    renderNotes(notes);
    renderSideList(notes);
    // Check for shared note in URL hash
    const h = location.hash;
    if(h.startsWith('#note=')){
      try {
        const enc = h.slice(6);
        const json = base64DecodeUnicode(enc);
        const obj = JSON.parse(json);
        showModal({title: obj.title, content: obj.content}, true);
      } catch(e){ console.error('Invalid shared note:', e); }
    }
  })();

  /* helper: commit when user saves (auto save of edited content) */
  window.addEventListener('beforeunload', ()=>{ /* no-op */ });
  </script>
</body>
</html>
